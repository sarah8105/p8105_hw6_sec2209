---
title: "P8105 Homework 6"
author: "sarah_8105"
output: github_document
---


This is my sixth homework assignment for P8105.

```{r libraries}
library(tidyverse)
library(rvest)
library(readr)
library(httr)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

In this first code chunk, I pull the Washington Post data on homicides in 50 large US cities. I create a `city_state` variable that concatenates the city and state that the homicide occurred in and remove an observation that was erroneously attributed to Tulsa, AL. 

```{r p1_import, cache = TRUE}
homicide_df = read_csv(file = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") %>%
  mutate(
    city_state = str_c(city, state, sep = "_")
  ) %>%
  select(city_state, disposition) %>%
  filter(city_state != "Tulsa_AL")
```




## Problem 2

Problem 2 focuses on understanding the effects of different variables on low birth weight. The data set consists of ~4000 children and factors related to their birth and their parents. In this first code chunk, I import and explore the data to assess distributions and missingness.


```{r bwt_import}
bwt_df = 
  read_csv("Data/birthweight.csv") %>%
  janitor::clean_names() %>%
  mutate(
    babysex = as_factor(babysex),
    frace = as_factor(frace),
    malform = as_factor(malform),
    mrace = as_factor(mrace),
    smoking_status = as_factor(if_else(smoken == 0, 0, 1)),
    menarche = if_else(menarche == 0, NA_real_, menarche)
  )  %>%
  select(-pnumlbw, -pnumsga)

summary(bwt_df)

```

There appears to be no missing data in this data set, but it's possible that some of the zeros represent missing data. For example, an age of menarchy of 0 is likely missing or erroneous and was therefore set to missing. However, some zeros are likely to be valid entries. For example, an average number of cigarettes smoked of 0 likely indicates that the mother was not a smoker. This variable was converted into a categorical smoking status variable of smoker vs. non-smoker. The number of prior low birth weight or small for gestational age babies is 0 for all subjects, so these variables will be uninformative for our models and were dropped from the data set. 

In the next code chunk I compare three models:
* Model 1: main effects of length at birth and gestational age only
* Model 2: including predictors of head circumference, length, sex, and all interactions between these variables
* Model 3: main effects of length at birth and gestational age, in addition to factors that have been demonstrated as significant predictors of low birth weight in the literature, including mother's race, baby's sex, smoking status, weight gain, and mother's pre-pregnancy BMI

```{r bwt_models}
model1 = lm(bwt ~ blength + gaweeks, data = bwt_df)
broom::tidy(model1)

bwt_df %>%
  modelr::add_predictions(model1) %>%
  modelr::add_residuals(model1) %>%
  ggplot(aes(x = resid, y = pred)) +
    geom_point(alpha = .5)

model2 = lm(bwt ~ bhead + blength + babysex + babysex*bhead*blength, data = bwt_df)
broom::tidy(model2)

bwt_df %>%
  modelr::add_predictions(model2) %>%
  modelr::add_residuals(model2) %>%
  ggplot(aes(x = resid, y = pred)) +
    geom_point(alpha = .5)
  
model3 = lm(bwt ~ blength + gaweeks + mrace + babysex + smoken + momage + ppbmi + wtgain, data = bwt_df)
broom::tidy(model3)

bwt_df %>%
  modelr::add_predictions(model3) %>%
  modelr::add_residuals(model3) %>%
  ggplot(aes(x = resid, y = pred)) +
    geom_point(alpha = .5)

```

